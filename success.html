<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bestellung erfolgreich - Maios</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="styles.css" rel="stylesheet">
    <link href="success.css" rel="stylesheet">
</head>
<body class="success-page">
    <div class="success-container">
        <div class="success-card">
            <div class="success-check">
                <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                    <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                    <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                </svg>
            </div>
            <h1 class="success-title">Vielen Dank f√ºr Ihre Bestellung!</h1>
            <p class="success-message">Wir haben Ihre Zahlung erhalten und senden Ihnen in K√ºrze eine Best√§tigung per E-Mail.</p>
            <div class="order-info">
                <div class="order-detail">
                    <i class="bi bi-box-seam"></i>
                    <span>Ihre Bestellung wird bearbeitet</span>
                </div>
                <div class="order-detail">
                    <i class="bi bi-envelope"></i>
                    <span>Best√§tigung wird gesendet</span>
                </div>
                <div class="order-detail" id="order-number-display" style="display: none;">
                    <i class="bi bi-receipt"></i>
                    <span>Bestellnummer: <strong id="order-number"></strong></span>
                </div>
                <div class="order-detail" id="receipt-number-display" style="display: none;">
                    <i class="bi bi-file-earmark-text"></i>
                    <span>Kassenbon-Nr: <strong id="receipt-number"></strong></span>
                </div>
            </div>
            <div class="success-actions">
                <a href="index.html" class="btn btn-primary btn-lg">
                    <i class="bi bi-house-door me-2"></i>Zur√ºck zum Shop
                </a>
            </div>
        </div>
    </div>
    <script>
        // Zeige Bestellinformationen an, falls vorhanden
        document.addEventListener('DOMContentLoaded', function() {
            // Pr√ºfe ob wir von Stripe Checkout kommen
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session_id');
            
            if (sessionId) {
                console.log('‚úÖ Stripe Checkout erfolgreich, Session ID:', sessionId);
            }
            
            // L√∂sche Warenkorb und Gutschein nach erfolgreicher Bestellung
            // (egal ob von Stripe oder direkter Aufruf)
            
            // ZUERST: Hole den angewendeten Gutschein-Code
            const appliedCode = localStorage.getItem('appliedVoucher');
            
            // L√∂sche Warenkorb
            localStorage.removeItem('cart');
            
            // Entferne den verwendeten Gutschein aus der Gutschein-Liste
            if (appliedCode) {
                const myVouchers = JSON.parse(localStorage.getItem('myVouchers') || '[]');
                // Entferne EINEN Gutschein mit diesem Code
                const voucherIndex = myVouchers.findIndex(id => {
                    // Finde den Gutschein-Code basierend auf ID
                    const vouchers = [
                        { id: 1, code: 'SAVE10' },
                        { id: 2, code: 'SAVE15' },
                        { id: 3, code: 'SAVE20' },
                        { id: 4, code: 'FREESHIP' },
                        { id: 5, code: 'WELCOME25' },
                        { id: 6, code: 'BUNDLE30' }
                    ];
                    const voucher = vouchers.find(v => v.id === id);
                    return voucher && voucher.code === appliedCode;
                });
                
                if (voucherIndex !== -1) {
                    myVouchers.splice(voucherIndex, 1);
                    localStorage.setItem('myVouchers', JSON.stringify(myVouchers));
                    console.log('üóëÔ∏è Verwendeter Gutschein aus Liste entfernt');
                }
            }
            
            localStorage.removeItem('appliedVoucher');
            console.log('‚úÖ Warenkorb und Gutschein gel√∂scht');
            
            const orderId = localStorage.getItem('lastOrderId');
            const receiptNumber = localStorage.getItem('lastReceiptNumber');
            
            if (orderId) {
                const orderDisplay = document.getElementById('order-number-display');
                const orderNumberSpan = document.getElementById('order-number');
                if (orderDisplay && orderNumberSpan) {
                    orderNumberSpan.textContent = orderId;
                    orderDisplay.style.display = 'flex';
                }
                
                // L√∂sche nach Anzeige
                localStorage.removeItem('lastOrderId');
            }
            
            if (receiptNumber) {
                const receiptDisplay = document.getElementById('receipt-number-display');
                const receiptNumberSpan = document.getElementById('receipt-number');
                if (receiptDisplay && receiptNumberSpan) {
                    receiptNumberSpan.textContent = receiptNumber;
                    receiptDisplay.style.display = 'flex';
                }
                
                // L√∂sche nach Anzeige
                localStorage.removeItem('lastReceiptNumber');
            }
        });
    </script>
</body>
</html>
